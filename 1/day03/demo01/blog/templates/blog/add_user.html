{% extends 'base.html' %}


{% block title %} 注册 {% endblock %}
{% block content %}

<script src="/static/js/lib/jquery2.2.4/jquery-2.2.4.min.js"></script>

<!-----------------------------------登录框-------------------------------------->
<div class="container">
    <div class="row dengluzhuce">
        <div class="col-md-8 col-md-offset-2">
            <h3><strong>用户注册</strong></h3>
            <div id="msg" class="alert alert-warning alert-dismissible" role="alert">
                <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <strong>{{msg}}</strong>
            </div>
            <!--<strong id="msg">{{msg}}</strong>-->
            <form class="form-horizontal" action="/blog/reg/" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <!--<div class="form-group">-->
                    <!--<label for="avatar" class="col-sm-2 control-label">头&nbsp;&nbsp;&nbsp;&nbsp;像&nbsp;&nbsp;&nbsp;&nbsp;</label>-->
                    <!--<div class="col-sm-10">-->
                        <!--<input type="file" name="avatar" id="avatar">-->
                    <!--</div>-->
                <!--</div>-->
                <div class="form-group">
                    <label for="nickname" class="col-sm-2 control-label">昵&nbsp;&nbsp;&nbsp;&nbsp;称&nbsp;&nbsp;&nbsp;&nbsp;</label>
                    <div class="col-sm-10">
                        <!--<input type="text" class="form-control" name="nickname" id="nickname" placeholder="账号长度必须是8~18位，只能包含字母、数字、下划线">-->
                        <input type="text" class="form-control" name="nickname" id="nickname" placeholder="取个名字吧">
                        <!--<span id="u_error">账号长度必须是8~18位，只能包含字母、数字、下划线</span>-->
                    </div>
                </div>
                <div class="form-group">
                    <label for="nickname" class="col-sm-2 control-label">账&nbsp;&nbsp;&nbsp;&nbsp;号&nbsp;&nbsp;&nbsp;&nbsp;</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" name="username" id="username" placeholder="账号长度必须是8~18位，只能包含字母、数字、下划线">
                    </div>
                </div>
                <div class="form-group">
                    <label for="userpass1" class="col-sm-2 control-label">密&nbsp;&nbsp;&nbsp;&nbsp;码&nbsp;&nbsp;&nbsp;&nbsp;</label>
                    <div class="col-sm-10">
                        <input type="password" class="form-control" name="password" id="userpass1" placeholder="请输入您的密码">
                    </div>
                </div>
                <div class="form-group">
                    <label for="userpass2" class="col-sm-2 control-label">确认密码</label>
                    <div class="col-sm-10">
                        <input type="password" class="form-control" name="confirmpwd" id="userpass2" placeholder="请再次输入您的密码">
                    </div>
                </div>
                <div class="from-group">
                    <label for="userpass2" class="col-sm-2 control-label">验证码</label>
                    <div class="col-sm-10">
                        <div class="col-md-4">
                            <input type="text" name="code" placeholder="请输入验证码" autocomplete="off">
                        </div>
                        <div class="col-md-3">
                            <a href="#" onclick="changeCode()"><img id="code" src="{% url 'blog:code' %}" alt="验证码" title="点击刷新"></a>
                        </div>
                        <div class="col-md-3">
                            <a href="#" onclick="changeCode()">刷新验证码</a>
                        </div>
                    </div>
                </div>
                <!--<div class="form-group">-->
                <!--<div class="col-sm-offset-2 col-sm-10">-->
                <!--<div class="checkbox">-->
                <!--<label>-->
                <!--<input type="checkbox">记住密码-->
                <!--</label>-->
                <!--</div>-->
                <!--</div>-->
                <!--</div>-->
                <!--<div class="modal-footer">-->
                    <!--<button type="button" class="btn btn-danger" data-dismiss="modal"><a href="blog/add_user.html">请确认</a></button>-->
                <!--</div>-->

                <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                <button type="submit" class="btn btn-default submit-btn">注册</button>
                </div>
                </div>
            </form>
        </div>
    </div>
</div>
<!-----------------------------------登录框-------------------------------------->

<script>
    function changeCode() {
//            document.getElementById("code").src = "/blog/code?id="+ new Date().getTime()
            document.getElementById("code").src = "/blog/code?id="+ Math.random()
        }


    $(function(){
        $("#username").on("blur", function(){
            uusername = $(this).val()
            $.ajax({
                url:"/blog/"+ uusername +"/checkusername/",
                method:"POST",
                dataType:"json",
                data:{"csrfmiddlewaretoken": "{{ csrf_token }}"},
                success:function(data){
                    console.info(data)
                    if (data.success){
                        $("#msg").html("<span style='color:blue'>"+ data.msg+"<span>")
                        $(".submit-btn").removeProp("disabled")
                        $(".submit-btn").show()
                    }else{
                        $("#msg").html("<span style='color:red'>"+ data.msg+"<span>")
                        $(".submit-btn").hide()
                    }
                }
            })
        })
    })

</script>

{% endblock %}