{% extends 'base.html' %}


{% block title %} 发布文章 {% endblock %}
{% block content %}

<!--引进的js模块-->
<!--<script type="text/javascript" src="/static/tiny_mce/tiny_mce.js"></script>-->
<script src="/static/js/lib/jquery2.2.4/jquery-2.2.4.js"></script>
<script type="text/javascript" src="/static/ueditor/ueditor.config.js"></script>
<script type="text/javascript" src="/static/ueditor/ueditor.all.min.js"></script>

<!---------------------------------主界面----------------------------------->
<div class="container">
    <div class="row dengluzhuce">
        <div class="col-md-8 col-md-offset-3">
            <h2><strong>文章发表</strong></h2>
            <div class="alert alert-warning alert-dismissible" role="alert">
                <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <strong id="msg">{{msg}}</strong>
            </div>
            <!--<form class="form-horizontal" action="/blog/add_article/" method="post">-->
                {% csrf_token %}
                <div class="form-group">
                    <div class="col-md-10">
                        <input type="text" class="form-control" name="title" id="title" placeholder="请输入文章标题">
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-md-10">
                        <textarea id="content" name="content" cols="100" rows="30" placeholder="在此输入你想输入的内容"></textarea>
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-md-10">
                        <button type="submit" class="btn btn-primary" onclick="add_article()">发表</button>
                    </div>
                </div>
            <!--</form>-->
        </div>
    </div>
</div>
<!-----------------------------------登录框-------------------------------------->
<script>

    var ue = UE.getEditor('content', {
        'initialFrameWidth': 700,
        'initialFrameHeight': 500,
        'serverUrl': '/ueditor/controller/?imagePathFormat=&filePathFormat=',
    })


    function add_article() {
        title = $("#title").val(),
        content = ue.getContent(),


        $.ajax({
            url:"/blog/add_article/",
            method:"POST",
            dataType:"json",
            data: {"title": title, "content": content, "csrfmiddlewaretoken": "{{ csrf_token }}"},
            success:function(data){
                if (data.success){
                    $("#msg").html(data.msg)
                    $("#title").val("")
                    ue.setContent("")

                    //演示前端跳转界面
                    window.location.pathname = "/blog/index/"
                } else{
                    $("#msg").html("文章添加失败，请重新添加")
                }
            }
        })
    }

</script>
{% endblock %}
